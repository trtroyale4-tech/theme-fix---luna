{% schema %}
{
  "name": "Tabs Slider",
  "settings": [
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top (px)",
      "default": 40,
      "min": 0,
      "max": 200,
      "step": 5
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom (px)",
      "default": 40,
      "min": 0,
      "max": 200,
      "step": 5
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show View All button",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "collection_tab",
      "name": "Collection Tab",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Tabs Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% assign section_id = section.id %}

<div
  class="page-width custom-new-tab"
  id="tabs-slider-{{ section_id }}"
  class="tabs-slider-section"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
>
  <!-- Tabs -->
  <ul class="tabs">
    {% for block in section.blocks %}
      {% if block.settings.collection %}
        <li class="tab {% if forloop.first %}active{% endif %}" data-tab="tab-{{ block.id }}">
          <h4>{{ block.settings.collection.title }}</h4>
        </li>
      {% endif %}
    {% endfor %}
  </ul>

  <!-- Tab Content -->
  {% for block in section.blocks %}
    {% assign collection = block.settings.collection %}
    {% if collection %}
      <div class="tab-content {% if forloop.first %}active{% endif %}" id="tab-{{ block.id }}">
        <ul class="product-slider">
          {% for product in collection.products limit: 8 %}
            <li class="product-slide">
              {%- render 'product-grid-item', product: product -%}
            </li>
          {% endfor %}
        </ul>

        {% if section.settings.show_view_all %}
          <div class="view-all-wrapper">
            <a href="{{ collection.url }}" class="btn view-all-btn">View All</a>
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>

<!-- Slick CSS & JS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>

<style>
  .custom-new-tab{
  overflow: hidden;
  }

  .custom-new-tab .view-all-wrapper{
    text-align: center;
  }

  .custom-new-tab ul.tabs li{
      list-style-type: none;
  }

  .custom-new-tab li.product-slide .grid__item{
      width: 100%;
      padding-left: 0;
  }
    #tabs-slider-{{ section_id }} .tabs {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      {% comment %} overflow-x: auto; {% endcomment %}
       flex-wrap: wrap; 
    }
    #tabs-slider-{{ section_id }} .tabs .tab h4 {
      letter-spacing: normal;
      cursor: pointer;
      padding: 0;
      white-space: nowrap;
      border-bottom: 2px solid transparent;
      font-size: 23px;
      line-height: normal;
      font-weight: 500;
      margin-bottom: 0;
      font-family: "Tenor Sans", sans-serif;
      }
    #tabs-slider-{{ section_id }} .tabs .tab.active h4 {
      border-bottom: 2px solid #000;
    }
    #tabs-slider-{{ section_id }} .tab-content { display: none; }
    #tabs-slider-{{ section_id }} .tab-content.active { display: block; }

    #tabs-slider-{{ section_id }} .product-slider .product-slide {
      padding: 10px;
    }
  #tabs-slider-{{ section_id }} .custom-slick-prev,
  #tabs-slider-{{ section_id }} .custom-slick-next {
    background: #d1a972;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    font-size: 20px;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
  }

  #tabs-slider-{{ section_id }} .custom-slick-prev { left: -15px; }
  #tabs-slider-{{ section_id }} .custom-slick-next { right: -15px; }

  /* Hide default Slick arrows */
  #tabs-slider-{{ section_id }} .slick-prev,
  #tabs-slider-{{ section_id }} .slick-next {
    display: none !important;
  }

    .custom-new-tab .slick-disabled{
      opacity: 0.5;
    }

  /* Mobile grid view */
  @media (max-width: 767px) {
    .custom-new-tab ul.product-slider{
      margin-left: 0;
    }

     .custom-new-tab ul.product-slider li{
      padding: 7px !important;
    }

    #tabs-slider-{{ section_id }} .product-slider {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr);
      gap: 0px;
    }
    #tabs-slider-{{ section_id }} .product-slider .product-slide {
      display: block !important;
    }

    /* Hide slick arrows on mobile */
    #tabs-slider-{{ section_id }} .custom-slick-prev,
    #tabs-slider-{{ section_id }} .custom-slick-next {
      display: none !important;
    }
      #tabs-slider-{{ section_id }} .tabs{
      margin-left: 0;
    }
  }
</style>

<script>
  jQuery(document).ready(function ($) {
    const section = $('#tabs-slider-{{ section_id }}');
    const tabs = section.find('.tab');
    const contents = section.find('.tab-content');

    // Custom arrows HTML
    const prevArrow = '<button type="button" class="custom-slick-prev">&#10094;</button>';
    const nextArrow = '<button type="button" class="custom-slick-next">&#10095;</button>';

    function initSliders() {
      const windowWidth = $(window).width();

      contents.each(function () {
        const slider = $(this).find('.product-slider');

        if (windowWidth >= 767) {
          // Desktop & Tablet → Initialize Slick if not already
          if (slider.length && !slider.hasClass('slick-initialized')) {
            slider.slick({
              infinite: false,
              slidesToShow: 4,
              slidesToScroll: 4,
              arrows: true,
              prevArrow: prevArrow,
              nextArrow: nextArrow,
              dots: false,
              responsive: [
                { breakpoint: 1200, settings: { slidesToShow: 3 } },
                { breakpoint: 992, settings: { slidesToShow: 2 } },
              ],
            });
          }
        } else {
          // Mobile → destroy slick and limit to 8 products
          if (slider.hasClass('slick-initialized')) {
            slider.slick('unslick');
          }

          // Show only first 8 products on mobile
          slider.find('.product-slide').hide().slice(0, 8).show();

          // Make them grid
          slider.css({
            display: 'grid',
            'grid-template-columns': 'repeat(2, 1fr)',
            gap: '0px',
          });
        }
      });
    }

    // Run on load & resize
    initSliders();
    $(window).on('resize', function () {
      initSliders();
    });

    // Tabs click event
    tabs.on('click', function () {
      const tabId = $(this).data('tab');
      tabs.removeClass('active');
      contents.removeClass('active');

      $(this).addClass('active');
      const activeContent = $('#' + tabId).addClass('active');

      // Refresh Slick only if initialized
      const activeSlider = activeContent.find('.product-slider');
      if (activeSlider.hasClass('slick-initialized')) {
        activeSlider.slick('setPosition');
      }
    });
  });
</script>
